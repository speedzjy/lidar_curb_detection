
language: cpp

os:
  - linux

sudo: required

dist: trusty
group: deprecated-2017Q4

compiler:
  - gcc
  - clang

env:
  global:
    - CI_HOME=`pwd`
  matrix:
    # Test python3
    - LIBCMAES=ON NLOPT=ON TBB=ON EXPERIMENTAL=OFF SFERES=OFF PYTHON=python3
    # Test LAPACK/BLAS
    - LIBCMAES=ON NLOPT=ON TBB=ON EXPERIMENTAL=OFF SFERES=OFF PYTHON=python2 EIGEN33=ON LAPACKE=--lapacke_blas
    # Eigen3.3
    - LIBCMAES=ON NLOPT=ON TBB=ON EXPERIMENTAL=OFF SFERES=OFF PYTHON=python2 EIGEN33=ON
    - LIBCMAES=ON NLOPT=ON TBB=OFF EXPERIMENTAL=OFF SFERES=OFF PYTHON=python2 EIGEN33=ON
    - LIBCMAES=ON NLOPT=OFF TBB=ON EXPERIMENTAL=OFF SFERES=OFF PYTHON=python2 EIGEN33=ON
    - LIBCMAES=ON NLOPT=OFF TBB=OFF EXPERIMENTAL=OFF SFERES=OFF PYTHON=python2 EIGEN33=ON
    - LIBCMAES=OFF NLOPT=ON TBB=ON EXPERIMENTAL=OFF SFERES=OFF PYTHON=python2 EIGEN33=ON
    - LIBCMAES=OFF NLOPT=ON TBB=OFF EXPERIMENTAL=OFF SFERES=OFF PYTHON=python2 EIGEN33=ON
    - LIBCMAES=OFF NLOPT=OFF TBB=ON EXPERIMENTAL=OFF SFERES=OFF PYTHON=python2 EIGEN33=ON
    - LIBCMAES=OFF NLOPT=OFF TBB=OFF EXPERIMENTAL=OFF SFERES=OFF PYTHON=python2 EIGEN33=ON
    - LIBCMAES=ON NLOPT=OFF TBB=OFF EXPERIMENTAL=ON SFERES=OFF PYTHON=python2 EIGEN33=ON
    - LIBCMAES=OFF NLOPT=OFF TBB=OFF EXPERIMENTAL=ON SFERES=OFF PYTHON=python2 EIGEN33=ON
    - LIBCMAES=ON NLOPT=OFF TBB=ON EXPERIMENTAL=ON SFERES=OFF PYTHON=python2 EIGEN33=ON
    - LIBCMAES=OFF NLOPT=OFF TBB=ON EXPERIMENTAL=ON SFERES=OFF PYTHON=python2 EIGEN33=ON
    - LIBCMAES=ON NLOPT=OFF TBB=OFF EXPERIMENTAL=ON SFERES=ON PYTHON=python2 EIGEN33=ON
    - LIBCMAES=OFF NLOPT=OFF TBB=OFF EXPERIMENTAL=ON SFERES=ON PYTHON=python2 EIGEN33=ON
    - LIBCMAES=ON NLOPT=OFF TBB=ON EXPERIMENTAL=ON SFERES=ON PYTHON=python2 EIGEN33=ON
    - LIBCMAES=OFF NLOPT=OFF TBB=ON EXPERIMENTAL=ON SFERES=ON PYTHON=python2 EIGEN33=ON
    # Eigen3
    - LIBCMAES=ON NLOPT=ON TBB=ON EXPERIMENTAL=OFF SFERES=OFF PYTHON=python2 EIGEN33=OFF
    - LIBCMAES=ON NLOPT=ON TBB=OFF EXPERIMENTAL=OFF SFERES=OFF PYTHON=python2 EIGEN33=OFF
    - LIBCMAES=ON NLOPT=OFF TBB=ON EXPERIMENTAL=OFF SFERES=OFF PYTHON=python2 EIGEN33=OFF
    - LIBCMAES=ON NLOPT=OFF TBB=OFF EXPERIMENTAL=OFF SFERES=OFF PYTHON=python2 EIGEN33=OFF
    - LIBCMAES=OFF NLOPT=ON TBB=ON EXPERIMENTAL=OFF SFERES=OFF PYTHON=python2 EIGEN33=OFF
    - LIBCMAES=OFF NLOPT=ON TBB=OFF EXPERIMENTAL=OFF SFERES=OFF PYTHON=python2 EIGEN33=OFF
    - LIBCMAES=OFF NLOPT=OFF TBB=ON EXPERIMENTAL=OFF SFERES=OFF PYTHON=python2 EIGEN33=OFF
    - LIBCMAES=OFF NLOPT=OFF TBB=OFF EXPERIMENTAL=OFF SFERES=OFF PYTHON=python2 EIGEN33=OFF
    - LIBCMAES=ON NLOPT=OFF TBB=OFF EXPERIMENTAL=ON SFERES=OFF PYTHON=python2 EIGEN33=OFF
    - LIBCMAES=OFF NLOPT=OFF TBB=OFF EXPERIMENTAL=ON SFERES=OFF PYTHON=python2 EIGEN33=OFF
    - LIBCMAES=ON NLOPT=OFF TBB=ON EXPERIMENTAL=ON SFERES=OFF PYTHON=python2 EIGEN33=OFF
    - LIBCMAES=OFF NLOPT=OFF TBB=ON EXPERIMENTAL=ON SFERES=OFF PYTHON=python2 EIGEN33=OFF
    - LIBCMAES=ON NLOPT=OFF TBB=OFF EXPERIMENTAL=ON SFERES=ON PYTHON=python2 EIGEN33=OFF
    - LIBCMAES=OFF NLOPT=OFF TBB=OFF EXPERIMENTAL=ON SFERES=ON PYTHON=python2 EIGEN33=OFF
    - LIBCMAES=ON NLOPT=OFF TBB=ON EXPERIMENTAL=ON SFERES=ON PYTHON=python2 EIGEN33=OFF
    - LIBCMAES=OFF NLOPT=OFF TBB=ON EXPERIMENTAL=ON SFERES=ON PYTHON=python2 EIGEN33=OFF

addons:
  apt:
    packages:
    - libboost1.55-all-dev
    - python
    - python3

before_install:
  - sudo sed -i -e 's/^Defaults\tsecure_path.*$//' /etc/sudoers
#  - sudo rm /etc/apt/sources.list.d/mongodb-3.2.list

install:
  - if [ "$EIGEN33" = "ON" ]; then 'ci/install_eigen3_3.sh' ; else 'ci/install_eigen3.sh' ; fi
  - if [ "$LIBCMAES" = "ON" ]; then 'ci/install_libcmaes.sh' ; fi
  - if [ "$NLOPT" = "ON" ]; then 'ci/install_nlopt.sh' ; fi
  - if [ "$TBB" = "ON" ]; then 'ci/install_tbb.sh' ; fi
  - if [ "$SFERES" = "ON" ]; then 'ci/install_sferes.sh' ; fi

# Change this to your needs
script:
  - if [ "$SFERES" = "OFF" ]; then $PYTHON ./waf configure --nowarnings $LAPACKE ; else $PYTHON ./waf configure --sferes=$CI_HOME/sferes2 --nowarnings ; fi
  - if [ "$EXPERIMENTAL" = "OFF" ]; then $PYTHON ./waf --tests --alltests -v ; else $PYTHON ./waf --experimental ; fi
